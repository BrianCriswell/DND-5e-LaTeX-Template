% Changing book to article will make the footers match on each page,
% rather than alternate every other.
%
% Note that the article class does not have chapters.
\documentclass[letterpaper,10pt,twoside,twocolumn,openany]{dndbook}

% Use babel or polyglossia to automatically redefine macros for terms
% Armor Class, Level, etc...
% Default output is in English; captions are located in lib/dndstring-captions.sty.
% If no captions exist for a language, English will be used.
%1. To load a language with babel:
%	\usepackage[<lang>]{babel}
%2. To load a language with polyglossia:
%	\usepackage{polyglossia}
%	\setdefaultlanguage{<lang>}
\usepackage[english]{babel}
%\usepackage[italian]{babel}
% For further options (multilanguage documents, hypenations, language environments...)
% please refer to babel/polyglossia's documentation.

\usepackage[utf8]{inputenc}
\usepackage{lipsum}
\usepackage{listings}

\lstset{%
  basicstyle=\ttfamily,
  language=[LaTeX]TeX,
  breaklines=true,
}

\begin{document}

% Comment this out if you're using the article class.
\chapter{Chapter 1: The Dark \LaTeX}

This package is designed to aid you in writing beautifully typeset documents for the fifth edition of the world's greatest roleplaying game.

\begin{DndReadAloud}
  As you approach this template you get a sense that the blood and tears of many generations went into its making. A warm feeling welcomes you as you type your first words.
\end{DndReadAloud}

\section{Fun with boxes}
The package has three environments for setting text apart so that it is drawn to the reader's attention. The \lstinline!quotebox! is shown above. It is used for text that a game master would read aloud.

The other two boxes are the \lstinline!DndComment! and the \lstinline!DndSidebar!. The \lstinline!DndSidebar! is not breakable and is best used floated toward a page corner while the \lstinline!DndComment! is breakable and can safely be used inline in the text.

\begin{DndComment}{This Is a Comment Box!}
  A \lstinline!DndComment! is a box for minimal highlighting of text. It lacks the ornamentation of \lstinline!DndSidebar!, but it can handle being broken over a column.
\end{DndComment}

\section{Headers}

The \lstinline!\DndItemHeader! is used for things like magic items and traps. Do not include a blank line after calling the function, or you will get a paragraph indent on the following paragraph. The \lstinline!\DndSpellHeader! is used at the top of spells. In both cases, you normally follow the text with a new item, spell, or some level of \lstinline!\section!. If you need to follow it with plain text instead, try inserting a \lstinline!\smallskip! to denote the end of the item.

\begin{DndSidebar}[float=!t]{Behold, the Sidebar!}
  The \lstinline!DndSidebar! is used as a sidebar. It does not break over columns and is best used with \lstinline!tcolorbox float! option float it to one corner of the page where the surrounding text can then flow around it.
\end{DndSidebar}

\DndItemHeader%
  {Foo's Quill}
  {Wondrous item, rare}
This quill has 3 charges. While holding it, you can use an action to expend 1 of its charges. The quill leaps from your hand and writes a contract applicable to your situation.

The quill regains 1d3 expended charges daily at dawn.

\section{Monsters and NPCs}
The \lstinline!monsterbox! environment is used to typeset monsters and NPCs.

\begin{DndMonster}[float*=t, width=\textwidth]{Monster Foo}
  \begin{multicols}{2}
    \DndMonsterType{Medium aberration (metasyntactic variable), neutral evil}

    % If you want to use commas in the key values, enclose the values in braces.
    \DndMonsterBasics[
        armor-class = {9 (12 with \emph{mage armor})},
        hit-points  = {\DndDice{3d8 + 3}},
        speed       = {30 ft., fly 30 ft.},
      ]

    \DndMonsterAbilityScores[
        str = 12,
        dex = 8,
        con = 13,
        int = 10,
        wis = 14,
        cha = 15,
      ]

    \DndMonsterDetails[
        %saving-throws = {Str +0, Dex +0, Con +0, Int +0, Wis +0, Cha +0},
        %skills = {Acrobatics +0, Animal Handling +0, Arcana +0, Athletics +0, Deception +0, History +0, Insight +0, Intimidation +0, Investigation +0, Medicine +0, Nature +0, Perception +0, Performance +0, Persuasion +0, Religion +0, Sleight of Hand +0, Stealth +0, Survival +0},
        %damage-vulnerabilities = {cold},
        %damage-resistances = {bludgeoning, piercing, and slashing from nonmagical attacks},
        %damage-immunities = {poison},
        %condition-immunities = {poisoned},
        senses = {darkvision 60 ft., passive Perception 10},
        languages = {Common, Goblin, Undercommon},
        challenge = 1,
      ]
    % Traits
    \DndMonsterAction{Innate Spellcasting}
    Foo's spellcasting ability is Charisma (spell save DC 12, +4 to hit with spell attacks). It can innately cast the following spells, requiring no material components:
    \begin{DndMonsterSpells}
      \DndInnateSpellLevel{misty step}
      \DndInnateSpellLevel[3]{fog cloud, rope trick}
      \DndInnateSpellLevel[1]{identify}
    \end{DndMonsterSpells}

    \DndMonsterAction{Spellcasting}
    Foo is a 2nd-level spellcaster. Its spellcasting ability is Charisma (spell save DC 12, +4 to hit with spell attacks). It has the following sorcerer spells prepared:
    \begin{DndMonsterSpells}
      \DndMonsterSpellLevel{blade ward, fire bolt, light, shocking grasp}
      \DndMonsterSpellLevel[1][3]{burning hands, mage armor, shield}
    \end{DndMonsterSpells}

    \DndMonsterSection{Actions}
    \DndMonsterAction{Multiattack}
    The foo makes two melee attacks.

    %Default values are shown commented out
    \DndMonsterAttack[
      name=Dagger,
      %distance=both, % valid options are in the set {both,melee,ranged},
      %type=weapon, %valid options are in the set {weapon,spell}
      mod=+3,
      %reach=5,
      %range=20/60,
      %targets=one target,
      dmg=\DndDice{1d4+1},
      dmg-type=piercing,
      %plus-dmg=,
      %plus-dmg-type=,
      %or-dmg=,
      %or-dmg-when=,
      %extra=,
    ]

    %\DndMonsterMelee calls \DndMonsterAttack with the melee option
    \DndMonsterMelee[
      name=Flame Tongue Longsword,
      mod=+3,
      %reach=5,
      %targets=one target,
      dmg=\DndDice{1d8+1},
      dmg-type=slashing,
      plus-dmg=\DndDice{2d6},
      plus-dmg-type=fire,
      or-dmg=\DndDice{1d10+1},
      or-dmg-when=if used with two hands,
      %extra=,
    ]

    %\DndMonsterRanged calls \DndMonsterAttack with the ranged option
    \DndMonsterRanged[
      name=Assassin's Light Crossbow,
      mod=+1,
      range=80/320,
      dmg=\DndDice{1d8},
      dmg-type=piercing,
      %plus-dmg=,
      %plus-dmg-type=,
      %or-dmg=,
      %or-dmg-when=,
      extra={, and the target must make a DC 15 Constitution saving throw, taking 24 (7d6) poison damage on a failed save, or half as much damage on a successful one}
    ]

    % Legendary Actions
    \DndMonsterSection{Legendary Actions}
    The foo can take 3 legendary actions, choosing from the options below. Only one legendary action option can be used at a time and only at the end of another creature's turn. The foo regains spent legendary actions at the start of its turn.
    \begin{DndMonsterLegendaryActions}
      \DndMonsterLegendaryAction{Move}{The foo moves up to its speed.}
      \DndMonsterLegendaryAction{Dagger Attack}{The foo makes a dagger attack.}
      \DndMonsterLegendaryAction{Create Contract (Costs 3 Actions)}{The foo presents a contract in a language it knows and waves it in the face of a creature within 10 feet. The creature must make a DC 10 Intelligence saving throw. On a failure, the creature is incapacitated until the start of the foo's next turn. A creature who cannot read the language in which the contract is written has advantage on this saving throw.}
    \end{DndMonsterLegendaryActions}

    \begin{DndMonsterDescription}
      \textbf{Foos} accumulate great wealth and magic, holding on to it through their speed and excessively complicated contracts.
    \end{DndMonsterDescription}
  \end{multicols}
\end{DndMonster}

\section{Spells}
\DndSpellHeader%
  {Beautiful Typesetting}
  {4th-level illusion}
  {1 action}
  {5 feet}
  {S, M (ink and parchment, which the spell consumes)}
  {Until dispelled}
You are able to transform a written message of any length into a beautiful scroll. All creatures within range that can see the scroll must make a wisdom saving throw or be charmed by you until the spell ends.

While the creature is charmed by you, they cannot take their eyes off the scroll and cannot willingly move away from the scroll. Also, the targets can make a wisdom saving throw at the end of each of their turns. On a success, they are no longer charmed.

\section{Tables}
% For more columns, you can say \begin{dndtable}[your options here].
% For instance, if you wanted three columns, you could say
% \begin{DndTable}{XXX}. The usual host of tabular parameters are
% available as well.
Tables are set to have alternate rows be colored.

\begin{DndTable}[header=Nice table]{XX}
  \textbf{Table head} & \textbf{Table head} \\
  Some value          & Some value \\
  Some value          & Some value \\
  Some value          & Some value
\end{DndTable}

\section{Colors}
This package provides several global color variables to style \lstinline!DndComment!, \lstinline!DndReadAloud!, \lstinline!DndSidebar!, and \lstinline!dndtable! environments.

\begin{DndTable}{lX}
  \textbf{Color}         & \textbf{Description} \\
  \lstinline!commentcolor! & Controls \lstinline!DndComment! background. \\
  \lstinline!sidebarcolor!   & Controls \lstinline!DndSidebar! background. \\
  \lstinline!readaloudcolor!   & Controls \lstinline!DndReadAloud! background. \\
  \lstinline!tablecolor!      & Controls background of even \lstinline!dndtable! rows. \\
\end{DndTable}

\begin{table*}
  \begin{DndTable}{XX}
    \textbf{Color}                            & \textbf{Description} \\
    \lstinline!PhbLightGreen!                      & Light green used in PHB Part 1 \\
    \lstinline!PhbLightCyan!                       & Light cyan used in PHB Part 2 \\
    \lstinline!PhbMauve!                           & Pale purple used in PHB Part 3 \\
    \lstinline!PhbTan!                             & Light brown used in PHB appendix \\
    \lstinline!DmgLavender!                        & Pale purple used in DMG Part 1 \\
    \lstinline!DmgCoral!                           & Orange-pink used in DMG Part 2 \\
    \lstinline!DmgSlateGray! (\lstinline!DmgSlateGrey!) & Blue-gray used in PHB Part 3 \\
    \lstinline!DmgLilac!                           & Purple-gray used in DMG appendix \\
  \end{DndTable}
  \caption{Colors supported by this package}%
  \label{tab:colors}
\end{table*}

See Table~\ref{tab:colors} for a list of accent colors that match the core books.

\begin{itemize}
  \item Use \lstinline!\setthemecolor[<color>]! to set \lstinline!themecolor!, \lstinline!commentcolor!, \lstinline!sidebarcolor!, and \lstinline!tablecolor! to a specific color.
  \item Calling \lstinline!\setthemecolor! without an argument sets those colors to the current \lstinline!themecolor!.
  \item \lstinline!DndComment!, \lstinline!dndtable!, \lstinline!DndSidebar!, and \lstinline!DndReadAloud! also accept an optional color argument to set the color for a single instance.
\end{itemize}

\subsection{Examples}

\subsubsection{Using \lstinline!themecolor!}

\begin{lstlisting}
\setthemecolor[PhbMauve]

\begin{DndSidebar}{Example}
  \lipsum[2]
\end{DndSidebar}

\setthemecolor[PhbLightCyan]

\begin{DndTable}[header=Example Table]{cX}
  \textbf{d8} & \textbf{Item} \\
  1           & Small wooden button \\
  2           & Red feather \\
  3           & Human tooth \\
  4           & Vial of green liquid \\
  6           & Tasty biscuit \\
  7           & Broken axe handle \\
  8           & Tarnished silver locket \\
\end{DndTable}
\end{lstlisting}

\begingroup
\DndSetThemeColor[PhbMauve]

\begin{DndSidebar}{Example}
  \lipsum[2]
\end{DndSidebar}

\DndSetThemeColor[PhbLightCyan]

\begin{DndTable}[header=Example Table]{cX}
  \textbf{d8} & \textbf{Item} \\
  1           & Small wooden button \\
  2           & Red feather \\
  3           & Human tooth \\
  4           & Vial of green liquid \\
  6           & Tasty biscuit \\
  7           & Broken axe handle \\
  8           & Tarnished silver locket \\
\end{DndTable}
\endgroup

\subsubsection{Using element color arguments}
\begin{lstlisting}
\begin{DndTable}[color=DmgCoral]{cX}
  \textbf{d8} & \textbf{Item} \\
  1           & Small wooden button \\
  2           & Red feather \\
  3           & Human tooth \\
  4           & Vial of green liquid \\
  6           & Tasty biscuit \\
  7           & Broken axe handle \\
  8           & Tarnished silver locket \\
\end{DndTable}
\end{lstlisting}

\begin{DndTable}[color=DmgCoral]{cX}
  \textbf{d8} & \textbf{Item} \\
  1           & Small wooden button \\
  2           & Red feather \\
  3           & Human tooth \\
  4           & Vial of green liquid \\
  6           & Tasty biscuit \\
  7           & Broken axe handle \\
  8           & Tarnished silver locket \\
\end{DndTable}

\newpage

\section{Map Regions}
The map region commands provide automatic numbering of areas.

\begin{lstlisting}
\DndSetAreaOptions[region=H]
\DndArea{Village of Hommlet}
This is the village of Hommlet. \DndAreaRef[region=F]{Foo's Castle} lies on the other side.

\DndSubArea{Inn of the Welcome Wench}
Inside the village is the inn of the Welcome Wench.

\DndSubArea{Blacksmith's Forge}
There's a blacksmith in town, too.

\DndSetAreaOptions[region=F]
\DndArea{Foo's Castle}
This is Foo's home, a hovel of mud and sticks.

\DndSubArea{Moat}
This ditch has a board spanning it.

\DndSubArea{Entrance}
A five-foot hole reveals the dirt floor illuminated by a hole in the roof.
\end{lstlisting}

\DndSetAreaOptions[region=H]
\DndArea{Village of Hommlet}
This is the village of Hommlet. \DndAreaRef[region=F]{Foo's Castle} lies on the other side.

\DndSubArea{Inn of the Welcome Wench}
Inside the village is the inn of the Welcome Wench.

\DndSubArea{Blacksmith's Forge}
There's a blacksmith in town, too.

\DndSetAreaOptions[region=F]
\DndArea{Foo's Castle}
This is Foo's home, a hovel of mud and sticks.

\DndSubArea{Moat}
This ditch has a board spanning it.

\DndSubArea{Entrance}
A five-foot hole reveals the dirt floor illuminated by a hole in the roof.

\end{document}
