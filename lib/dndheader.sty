\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom headers and footers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bool_if:NT \l__dnd_layout_bool
	{
		% Setup for custom footer
		\pagestyle {fancy}

		\renewcommand {\headrulewidth} {0.0pt} % no rule for header
		\renewcommand {\footrulewidth} {0.0pt} % no rule for footer

		\fancyhf {} % clear all headers and footers

		% Header is used to include the page background
		\fancyhead
			{
				\bool_if:NT \l__dnd_show_background_bool
					{
						\begin {tikzpicture} [ remember~picture, overlay ]
							\node [ inner~sep = 0pt ] at ( current~page.center )
								{
									\includegraphics
										[
											width  = \paperwidth,
											height = \paperheight
										]
										{ img/paper }
								};
						\end{tikzpicture}
					}
			}

		% Left-even page footer
		\fancyfoot [LE]
			{
				\begin{tikzpicture} [ remember~picture, overlay ]
					\bool_if:NT \l__dnd_show_footer_scroll_bool
						{
							\node
								[
									xscale    = -1,
									inner~sep = 0pt,
									anchor    = south,
									nearly~opaque
								] at ( current~page.south )
								{
									\includegraphics
										[
											width  = \paperwidth,
											height = 43pt
										]
										{ img/footerscroll }
								};
						}
					\node [ xshift = 20pt, yshift = 30pt ] at ( current~page.south~west )
						{ \l__dnd_font_page_number_tl \textcolor {pagegold} {\thepage} };
					\node
						[
							anchor = base~west,
							xshift = \marginparwidth+\marginparpush,
							yshift = 33pt
						] at ( current~page.south~west )
						{ \l__dnd_font_footer_tl { \textcolor {pagegold} { \nouppercase \leftmark } } };
				\end{tikzpicture}
			}

		% Right-odd page footer
		\fancyfoot [RO]
			{
				\begin {tikzpicture} [ remember~picture, overlay ]
					\bool_if:NT \l__dnd_show_footer_scroll_bool
						{
							\node
								[
									inner~sep = 0pt,
									anchor    = south,
									nearly~opaque
								] at ( current~page.south )
								{
									\includegraphics
										[
											width  = \paperwidth,
											height = 43pt
										]
										{ img/footerscroll }
								};
						}
					\node [ xshift = -20pt, yshift = 30pt ] at ( current~page.south~east )
						{ \l__dnd_font_page_number_tl \textcolor {pagegold} {\thepage} };
					\node
						[
							anchor = base~east,
							xshift = -\marginparwidth-\marginparpush,
							yshift = 33pt
						] at ( current~page.south~east )
						{ \l__dnd_font_footer_tl { \textcolor {pagegold} { \nouppercase \leftmark } } };
				\end {tikzpicture}
			}

		\fancypagestyle {plain} {}
  }

\ExplSyntaxOff