\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newenvironment{lmss}{%
  \dnd@deprecate{lmss}{0.7}
  \fontfamily{lmss}\selectfont
  }{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Utility functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand { \dice } { m }
  {
    \dnd@deprecate{\noexpand\dice}{1.0}[Use~\noexpand\DndDice.]
    \DndDice { #1 }
  }

\let\oldhline\hline

\renewcommand{\hline}
  {
    \dnd@deprecate{\noexpand\hline~/~\noexpand\dndline}{0.8}[Use~\noexpand\DndMonsterLine~for~stat~block~rules.~You~can~access~the~normal~tabular~\noexpand\hline~through~\noexpand\oldhline~until~this~is~removed.]
    \DndMonsterLine
  }

\let\dndline\hline

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Monsters
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Environments
\NewDocumentEnvironment { monsterbox } { O {} m }
  {
    \dnd@deprecate{\noexpand\monsterbox}{1.0}[Use \noexpand\DndMonster.]
    \begin{DndMonster} [ #1 ] { #2 }
  }
  { \end{DndMonster} }

\NewDocumentEnvironment { monsterboxbg } { O {} m }
  {
    \dnd@deprecate{\noexpand\monsterbox}{1.0}[Use \noexpand\DndMonsterBg.]
    \begin{DndMonsterBg} [ #1 ] { #2 } }
  { \end{DndMonsterBg} }

\NewDocumentEnvironment { monsterboxnobg } { O {} m }
  {
    \dnd@deprecate{\noexpand\monsterbox}{1.0}[Use \noexpand\DndMonsterNoBg.]
    \begin{DndMonsterNoBg} [ #1 ] { #2 } }
  { \end{DndMonsterNoBg} }

% Alias DndMonster to correct background type
\iftoggle { bool-bg }
  {
    \let\monsterbox\monsterboxbg
    \let\endmonsterbox\endmonsterboxbg
  }{
    \let\monsterbox\monsterboxnobg
    \let\endmonsterbox\endmonsterboxnobg
  }

% Stat block elements
\NewDocumentCommand { \basics } { o }
  {
    \dnd@deprecate {\noexpand\basics} {1.0} [Use \noexpand\DndMonsterBasics]
    \group_begin:
      \keys_set:nn { dnd / monster / basics } { #1 }
      \__dnd_monster_basics:
    \group_end:
  }

\NewDocumentCommand { \details } { o }
  {
    \dnd@deprecate {\noexpand\details} {1.0} [Use \noexpand\DndMonsterDetails]
    \group_begin:
      \keys_set:nn { dnd / monster / details } { #1 }
      \__dnd_monster_details:
    \group_end:
  }

\NewDocumentCommand { \stat } { m }
  {
    \dnd@deprecate{\noexpand\stat}{1.0}[Use \noexpand\DndMonsterAbilityScores~with~ ~just~the~numbers~instead.]
    \__dnd_ability_score_modifier:N { #1 }
  }

\newkeycommand\stats
  [
    STR=\stat{10},
    DEX=\stat{10},
    CON=\stat{10},
    INT=\stat{10},
    WIS=\stat{10},
    CHA=\stat{10}
  ]{
    \dnd@deprecate{\noexpand\stats}{1.0}[Use \noexpand\DndMonsterAbilityScores~with~ ~just~the~numbers~instead.]
    \DndMonsterAbilityScores
      [
        str = \commandkey{STR},
        dex = \commandkey{DEX},
        con = \commandkey{CON},
        int = \commandkey{INT},
        wis = \commandkey{WIS},
        cha = \commandkey{CHA}
      ]
}

\NewDocumentEnvironment { monsteraction }{ o }
  {
    \dnd@deprecate { monsteraction environment } { 1.0 } [Use ~ \noexpand \DndMonsterAction { action } ]%
    \IfValueTF{#1}
      { \smallskip \emph { \textbf { #1. } } }
      { \unskip }
  }
  { \par }

\NewDocumentCommand { \monstersection } { m }
  {    
    \dnd@deprecate { \noexpand \monstersection } { 1.0 } [Use ~ \noexpand \DndMonsterSection ]
    \begingroup
    \par\medskip\color{titlered}
    \dnd@StatBlockSubtitleFont\large #1
    % \rule is a horizontal command, so placing it under the title incurs extra
    % line spacing. Use \hrule (a vertical command) instead.
    \vspace{3pt}
    \noindent\hrule height 0.6pt
    \vspace{3pt}
    \endgroup
  }

\ExplSyntaxOff